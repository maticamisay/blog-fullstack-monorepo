{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Mati/Documents/Programacion/blog-fullstack-monorepo/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Mati/Documents/Programacion/blog-fullstack-monorepo/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Mati/Documents/Programacion/blog-fullstack-monorepo/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{createContext,useEffect,useState}from\"react\";import{login,checkJWT}from\"../services/login\";import{jsx as _jsx}from\"react/jsx-runtime\";var LoginContext=/*#__PURE__*/createContext('');export function LoginProvider(_ref){var _ref$defaultValue=_ref.defaultValue,defaultValue=_ref$defaultValue===void 0?[]:_ref$defaultValue,children=_ref.children;var _useState=useState(defaultValue),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUsername=_useState2[1];var _useState3=useState(defaultValue),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(defaultValue),_useState6=_slicedToArray(_useState5,2),errorMessage=_useState6[0],setErrorMessage=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isLoggedIn=_useState8[0],setIsLoggedIn=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),user=_useState10[0],setUser=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),token=_useState12[0],setToken=_useState12[1];var handleLogin=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(username,password){var _user;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return login({username:username,password:password});case 3:_user=_context.sent;setUser(_user);setIsLoggedIn(true);console.log(isLoggedIn);setToken(_user.token);window.localStorage.setItem('loggedPostAppUser',JSON.stringify(_user));setUsername(\"\");setPassword(\"\");_context.next=20;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);console.log(_context.t0);setErrorMessage(\"Wrong credentials\");setUsername(\"\");setPassword(\"\");// quitamos el error después de 5 segundos\nsetTimeout(function(){setErrorMessage(null);},5000);case 20:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return function handleLogin(_x,_x2){return _ref2.apply(this,arguments);};}();var isLogged=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var localLoggedUser,_JSON$parse,_username,_token,tokencito;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:try{localLoggedUser=window.localStorage.getItem(\"loggedPostAppUser\");_JSON$parse=JSON.parse(localLoggedUser),_username=_JSON$parse.username,_token=_JSON$parse.token;tokencito=\"Bearer \".concat(_token);setToken(tokencito);checkJWT(_username,tokencito).then(function(e){if(e.status===200){setUser(e.data.user);setIsLoggedIn(true);}});}catch(e){console.log('Not logged');}case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function isLogged(){return _ref3.apply(this,arguments);};}();var handleLoggedOut=function handleLoggedOut(){setUser(false);setIsLoggedIn(false);window.localStorage.removeItem('loggedPostAppUser');};useEffect(function(){isLogged();},[isLoggedIn]);return/*#__PURE__*/_jsx(LoginContext.Provider,{value:{token:token,setToken:setToken,isLogged:isLogged,isLoggedIn:isLoggedIn,handleLoggedOut:handleLoggedOut,username:username,setUsername:setUsername,password:password,setPassword:setPassword,handleLogin:handleLogin,errorMessage:errorMessage,user:user},children:children});}export default LoginContext;","map":{"version":3,"names":["createContext","useEffect","useState","login","checkJWT","LoginContext","LoginProvider","defaultValue","children","username","setUsername","password","setPassword","errorMessage","setErrorMessage","isLoggedIn","setIsLoggedIn","user","setUser","token","setToken","handleLogin","console","log","window","localStorage","setItem","JSON","stringify","setTimeout","isLogged","localLoggedUser","getItem","parse","tokencito","then","e","status","data","handleLoggedOut","removeItem"],"sources":["C:/Users/Mati/Documents/Programacion/blog-fullstack-monorepo/app/src/context/LoginContext.js"],"sourcesContent":["import { createContext, useEffect, useState } from \"react\";\r\nimport {login,checkJWT} from \"../services/login\";\r\nconst LoginContext = createContext('');\r\n\r\nexport function LoginProvider({ defaultValue = [], children }) {\r\n    const [username, setUsername] = useState(defaultValue);\r\n    const [password, setPassword] = useState(defaultValue);\r\n    const [errorMessage, setErrorMessage] = useState(defaultValue);\r\n    const [isLoggedIn, setIsLoggedIn] = useState(false)\r\n    const [user, setUser] = useState(false);\r\n    const [token, setToken] = useState(null)\r\n\r\n\r\n    const handleLogin = async (username, password) => {\r\n\r\n        try {\r\n            const user = await login({ username, password });\r\n            setUser(user);\r\n            setIsLoggedIn(true);\r\n            console.log(isLoggedIn);\r\n            setToken(user.token);\r\n            window.localStorage.setItem(\r\n                'loggedPostAppUser', JSON.stringify(user)\r\n            )\r\n            setUsername(\"\");\r\n            setPassword(\"\");\r\n        } catch (e) {\r\n            console.log(e);\r\n            setErrorMessage(\"Wrong credentials\");\r\n            setUsername(\"\");\r\n            setPassword(\"\");\r\n            // quitamos el error después de 5 segundos\r\n            setTimeout(() => {\r\n                setErrorMessage(null);\r\n            }, 5000);\r\n        }\r\n    }\r\n\r\n    const isLogged = async () => {\r\n        try {\r\n            const localLoggedUser = window.localStorage.getItem(\"loggedPostAppUser\");\r\n            const { username, token } = JSON.parse(localLoggedUser);\r\n            const tokencito = `Bearer ${token}`\r\n            setToken(tokencito)\r\n            checkJWT(username, tokencito).then(e => {\r\n                if (e.status === 200) {\r\n                    setUser(e.data.user);\r\n                    setIsLoggedIn(true);\r\n                }\r\n            })\r\n        } catch (e) {\r\n           console.log('Not logged');\r\n        }\r\n    }\r\n\r\n    const handleLoggedOut = () => {\r\n        setUser(false);\r\n        setIsLoggedIn(false)\r\n        window.localStorage.removeItem('loggedPostAppUser')\r\n    }\r\n    useEffect(()=>{\r\n        isLogged()\r\n    },[isLoggedIn])\r\n    return (\r\n        <LoginContext.Provider value={{ token, setToken, isLogged, isLoggedIn, handleLoggedOut, username, setUsername, password, setPassword, handleLogin, errorMessage, user }}>\r\n            {children}\r\n        </LoginContext.Provider>\r\n    )\r\n}\r\nexport default LoginContext;"],"mappings":"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"},"metadata":{},"sourceType":"module"}